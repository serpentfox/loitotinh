<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chat - Lá»i tá» tÃ¬nh</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">
      <h3>Tin nháº¯n</h3>
    </div>
    <div class="chat-messages" id="chatMessages">
      <div class="message other">
        <img src="assets/avatar2.png" alt="Anh" class="avatar" />
        <p>ChÃ o em, anh Ä‘ang ráº¥t há»“i há»™p khi gá»­i Ä‘iá»u nÃ y...</p>
      </div>
      <div class="message other">
        <img src="assets/avatar2.png" alt="Anh" class="avatar" />
             </div>
      <div class="message user">
        <img src="assets/avatar1.png" alt="Em" class="avatar" />
        <p>á»ªm, anh Ä‘ang nÃ³i gÃ¬ váº­y?</p>
      </div>
    </div>
    <div class="chat-input">
      <input type="text" id="messageInput" placeholder="Nháº­p cÃ¢u nÃ³i tiáº¿p theo..." />
    </div>
    <div id="proposal" class="proposal hidden">
      <p>Em cÃ³ muá»‘n lÃ m em bÃ© cá»§a anh khÃ´ng?</p>
      <div class="proposal-buttons">
        <button id="agreeBtn">Äá»“ng Ã½</button>
        <button id="declineBtn">Tá»« chá»‘i</button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const messages = document.getElementById("chatMessages");
      const messageInput = document.getElementById("messageInput");
      const proposal = document.getElementById("proposal");
      const agreeBtn = document.getElementById("agreeBtn");
      const declineBtn = document.getElementById("declineBtn");

      const responses = [
        "Anh tháº¥y em nÃ³i chuyá»‡n ráº¥t Ä‘Ã¡ng yÃªu.",
        "em cÃ³ tháº¥y anhh bÃªn em lÃ  á»•n hÃ´ng.",
        "Em cÃ³ muá»‘n anh lÃ m ngÆ°á»i bÃªn em má»—i ngÃ yy hÃ´m",
        "em cÃ³ yÃªu cáº§u gÃ¬ khi anh á»Ÿ bÃªn em hÃ´ng.",
        "Em nÃ³i gÃ¬ anh cÅ©ng muá»‘n nghe cáº£ Ä‘á»i.",
        "emm cÃ³ tinn tÆ°á»Ÿng anhh hÃ´ngg hay cÃ²n nghi ngá» anh Ä‘áº¥y.",
        "anhh khÃ´ng há»©a mÃ¬nh tá»‘t nhÆ°ng anh sáº½ cá»‘ gáº¯ng Ä‘á»ƒ tá»‘t khi bÃªn em.",
        "em cÃ³ nghÄ© anh lÃ  ngÆ°á»i duy nháº¥t khiáº¿n anh cáº£m tháº¥y an toÃ n.",
        "Anh muá»‘n Ä‘Æ°á»£c á»Ÿ bÃªn em má»—i ngÃ y, ká»ƒ cáº£ khi khÃ´ng nÃ³i gÃ¬.",
        "Em cho anh cÆ¡ há»™i Ä‘Æ°á»£c á»Ÿ bÃªn em nhÃ© <3 "
      ];

      let userMessageCount = 3;

      function showTypingIndicator() {
        const typingDiv = document.createElement("div");
        typingDiv.className = "message other typing";
        typingDiv.innerHTML = `
          <img src="assets/avatar2.png" alt="Anh" class="avatar" />
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
        `;
        messages.appendChild(typingDiv);
        messages.scrollTop = messages.scrollHeight;
        return typingDiv;
      }

      function removeTypingIndicator(typingDiv) {
        typingDiv.remove();
      }

      function typeText(element, text, delay = 50) {
        let i = 0;
        element.textContent = "";
        const timer = setInterval(() => {
          if (i < text.length) {
            element.textContent += text.charAt(i);
            i++;
          } else {
            clearInterval(timer);
          }
        }, delay);
      }

      function sendResponse(text) {
        const typingDiv = showTypingIndicator();
        setTimeout(() => {
          removeTypingIndicator(typingDiv);
          const otherMsg = document.createElement("div");
          otherMsg.className = "message other";
          otherMsg.innerHTML = `
            <img src="assets/avatar2.png" alt="Anh" class="avatar" />
            <p></p>
          `;
          messages.appendChild(otherMsg);
          messages.scrollTop = messages.scrollHeight;
          const p = otherMsg.querySelector("p");
          typeText(p, text, 40);
          saveChat(text, "other"); // LÆ°u vÃ o localStorage
        }, 1000);
      }

      messageInput?.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          const text = messageInput.value.trim();
          if (!text) return;

          const userMsg = document.createElement("div");
          userMsg.className = "message user";
          userMsg.innerHTML = `
            <img src="assets/avatar1.png" alt="Em" class="avatar" />
            <p>${text}</p>
          `;
          messages.appendChild(userMsg);
          messages.scrollTop = messages.scrollHeight;
          saveChat(text, "user"); // LÆ°u vÃ o localStorage

          userMessageCount++;

          const responseIndex = userMessageCount - 4;
          if (responseIndex < responses.length) {
            sendResponse(responses[responseIndex]);
          }

          messageInput.value = "";

          if (userMessageCount === 10) {
            proposal.classList.remove("hidden");
            messageInput.disabled = true;
          }
        }
      });

      // âœ… Gá»­i email khi ngÆ°á»i dÃ¹ng chá»n "Äá»“ng Ã½" hoáº·c "Tá»« chá»‘i"
      agreeBtn?.addEventListener("click", () => {
        const username = localStorage.getItem("foxgaming0504@gmail.com") || "foxgaming0504@gmail.com";
        const message = "NgÆ°á»i dÃ¹ng Ä‘Ã£ Ä‘á»“ng Ã½ lÃ m em bÃ© cá»§a anh! ğŸ˜";

        // âœ… Gá»­i email báº±ng emailjs
